"use strict";(self["webpackChunkoc_front_end"]=self["webpackChunkoc_front_end"]||[]).push([[940],{940:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ee});var o=s(3673),a=s(2323),l=s(8880),r=s(3402),i=s.n(r);const n=(0,o._)("img",{alt:"oneconnect logo",src:i(),style:{height:"30px",width:"30px"}},null,-1),m={class:"flex flex-center q-mr-sm"},d=(0,o.Uk)("4"),u=(0,o.Uk)("2"),c=["src"],g=(0,o.Uk)("Settings"),p=(0,o.Uk)("Log out"),f=["src"],w={key:0,class:"q-pa-md text-grey"},h={class:"flex"},b=["src"],_={class:"q-mt-sm text-grey"},y={key:0,class:"fit flex items-center q-pl-md justify-start column bg-grey-1"},W={class:"row full-width"},k=["src"],v={class:"text-h6 q-ma-none text-grey"};function x(e,t,s,r,i,x){const I=(0,o.up)("q-btn"),q=(0,o.up)("q-space"),S=(0,o.up)("q-badge"),Z=(0,o.up)("q-avatar"),Q=(0,o.up)("q-item-section"),C=(0,o.up)("q-item"),U=(0,o.up)("q-list"),z=(0,o.up)("q-menu"),N=(0,o.up)("q-toolbar-title"),R=(0,o.up)("q-toolbar"),D=(0,o.up)("q-header"),L=(0,o.up)("q-item-label"),T=(0,o.up)("q-select"),M=(0,o.up)("q-popup-edit"),O=(0,o.up)("q-icon"),V=(0,o.up)("q-input"),P=(0,o.up)("q-separator"),B=(0,o.up)("q-scroll-area"),H=(0,o.up)("q-drawer"),J=(0,o.up)("router-view"),E=(0,o.up)("q-page-container"),j=(0,o.up)("q-layout"),A=(0,o.Q2)("close-popup"),F=(0,o.Q2)("ripple");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(j,{view:"hHh lpR fFf",container:"",style:{height:"100vh"},class:"shadow-2"},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{class:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(R,{class:"bg-primary text-white shadow-2"},{default:(0,o.w5)((()=>[(0,o.Wm)(N,{class:"flex"},{default:(0,o.w5)((()=>[(0,o.Wm)(I,{flat:"",round:"",icon:"menu",onClick:t[0]||(t[0]=e=>i.drawer=!i.drawer)}),(0,o.Wm)(I,{flat:"",round:"",icon:"chevron_left",to:"/"}),(0,o.Wm)(I,{flat:"",round:""},{default:(0,o.w5)((()=>[n])),_:1}),(0,o.Wm)(q),(0,o._)("div",m,[(0,o.Wm)(I,{flat:"",color:"white",round:"",icon:"email",size:"sm"},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{color:"red",rounded:"",floating:""},{default:(0,o.w5)((()=>[d])),_:1})])),_:1}),(0,o.Wm)(I,{flat:"",color:"white",round:"",icon:"notifications",size:"sm"},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{rounded:"",color:"red",floating:""},{default:(0,o.w5)((()=>[u])),_:1})])),_:1})]),(0,o.Wm)(I,{flat:"",round:""},{default:(0,o.w5)((()=>[null!==e.user.avatar?((0,o.wg)(),(0,o.iD)("img",{key:0,alt:"User logo",src:e.user.avatar,style:{height:"30px",width:"30px","border-radius":"50%"}},null,8,c)):((0,o.wg)(),(0,o.j4)(Z,{key:1,size:"30px","font-size":"10px",color:"grey","text-color":"white",icon:"person"})),(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(C,{to:"/profile",clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(Q,null,{default:(0,o.w5)((()=>[g])),_:1})])),_:1},512),[[A]]),(0,o.Wm)(C,{clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(Q,{onClick:x.logout},{default:(0,o.w5)((()=>[p])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(H,{modelValue:i.drawer,"onUpdate:modelValue":t[3]||(t[3]=e=>i.drawer=e),"show-if-above":"",width:300,breakpoint:1185},{default:(0,o.w5)((()=>[(0,o.Wm)(I,{round:"",icon:"add",class:"absolute-bottom-right q-mr-sm q-mb-sm",color:"primary",style:{"z-index":"10 !important"}},{default:(0,o.w5)((()=>[(0,o.Wm)(M,{modelValue:i.members,"onUpdate:modelValue":t[2]||(t[2]=e=>i.members=e),style:{"min-width":"15rem !important"},cover:!1,offset:[0,10]},{default:(0,o.w5)((e=>[(0,o.Wm)(T,{ref:"clientRef",rules:[e=>null!==e||"This field is required"],"bg-color":"white",outlined:"",counter:"",multiple:"","use-chips":"",loading:i.isLoading,modelValue:i.members,"onUpdate:modelValue":t[1]||(t[1]=e=>i.members=e),options:i.options,label:"Choose members"},{option:(0,o.w5)((e=>[(0,o.Wm)(C,(0,a.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(Q,{class:"avatar-list"},{default:(0,o.w5)((()=>[(0,o.Wm)(Z,{class:"q-mr-xs",size:"30px"},{default:(0,o.w5)((()=>[(0,o._)("img",{src:e.opt.avatar?e.opt.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,f)])),_:2},1024),(0,o.Wm)(L,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:2},1032,["rules","loading","modelValue","options"]),(0,o.wy)((0,o.Wm)(I,{onClick:x.addMembs,"no-caps":"",flat:"",label:"submit",color:"primary",disable:0===i.members.length},null,8,["onClick","disable"]),[[A]])])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(B,{ref:"scrollAreaRef",style:{height:"100%","border-right":"1px solid #ddd"}},{default:(0,o.w5)((()=>[(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[(0,o.Wm)(C,{style:{position:"sticky",top:"0","z-index":"5","background-color":"white"}},{default:(0,o.w5)((()=>[(0,o.Wm)(V,{class:"full-width",outlined:"",label:"Search"},{prepend:(0,o.w5)((()=>[(0,o.Wm)(O,{name:"search",class:"q-ml-sm"})])),_:1})])),_:1}),0===i.rooms.length?((0,o.wg)(),(0,o.iD)("div",w,"No rooms to show!")):((0,o.wg)(!0),(0,o.iD)(o.HY,{key:1},(0,o.Ko)(i.rooms,((t,s)=>((0,o.wg)(),(0,o.iD)("div",{key:s},[(0,o.wy)((0,o.Wm)(C,{class:(0,a.C_)(t.id===e.chat.id?"bg-blue-1":""),style:(0,a.j5)(t.id===e.chat.id?"border: .5px solid skyblue":""),onClick:e=>x.getMessages(t,s),clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(Q,null,{default:(0,o.w5)((()=>[(0,o.Wm)(L,null,{default:(0,o.w5)((()=>[(0,o._)("div",h,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.users,((t,s)=>((0,o.wg)(),(0,o.iD)("div",{class:"text-ellipses",key:t.id},[t.id!==e.user.id?(0,o.wy)(((0,o.wg)(),(0,o.j4)(Z,{key:0,class:(0,a.C_)(1===s&&"q-ml-xs"),size:"25px"},{default:(0,o.w5)((()=>[(0,o._)("img",{src:t.avatar?t.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,b)])),_:2},1032,["class"])),[[l.F8,s<2]]):(0,o.kq)("",!0)])))),128)),(0,o._)("p",_,(0,a.zw)(t.users.length>2?"...+"+(t.users.length-2):""),1)])])),_:2},1024),(0,o.Wm)(L,{class:(0,a.C_)(t.users.length<2||2===t.users.length?"q-pt-md":""),caption:"",lines:"1"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(0!==t.messages.length?t.messages[t.messages.length-1].text:"No messages!"),1)])),_:2},1032,["class"])])),_:2},1024),(0,o.Wm)(Q,{side:"",top:""},{default:(0,o.w5)((()=>[(0,o.Wm)(L,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(0!==t.messages.length?x.format(t.messages[t.messages.length-1].created_at):""),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","style","onClick"]),[[F]]),(0,o.Wm)(P)])))),128))])),_:1})])),_:1},512)])),_:1},8,["modelValue"]),(0,o.Wm)(H,{"show-if-above":"",side:"right",bordered:"",width:400,breakpoint:1185,class:"bg-grey-1",style:{"overflow-y":"hidden !important"}},{default:(0,o.w5)((()=>[e.chat?((0,o.wg)(),(0,o.iD)("div",y,[(0,o._)("div",W,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.chat.users,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"flex column flex-center q-ma-sm"},[(0,o.Wm)(Z,{size:"75px"},{default:(0,o.w5)((()=>[(0,o._)("img",{src:e.avatar?e.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,k)])),_:2},1024),(0,o._)("p",v,(0,a.zw)(e.name),1)])))),128))])])):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(E,null,{default:(0,o.w5)((()=>[(0,o.Wm)(J)])),_:1})])),_:1})])}var I=s(1082),q=s(3617);const S=new WebSocket("wss://oneconnect.it:4000"),Z={data(){return{isLoggedIn:localStorage.getItem("accessToken"),isExpanded:!0,isExpanded2:!0,members:[],options:[],rooms:[],roomInfo:null,isLoading:!1,drawer:!1}},computed:{...(0,q.rn)("example",["user"]),...(0,q.rn)("userStore",["users"]),...(0,q.rn)("chatStore",["chat"])},methods:{...(0,q.nv)("userStore",["getUsers"]),...(0,q.nv)("example",["getUser"]),...(0,q.nv)("chatStore",["getChat"]),async getMessages(e,t){document.body.offsetWidth<=1185&&(this.drawer=!1),localStorage.setItem("roomIndex",t),S.send(JSON.stringify({getMessagesByRoomId:{room_id:e.id}})),this.roomInfo=e},format(e){return I.ZP.formatDate(e,"HH:mm")},addMembs(){let e=[];for(let t=0;t<this.members.length;t++)e.push(Number(this.members[t].id));S.send(JSON.stringify({createRoom:{users:e}}))},logout(){localStorage.removeItem("accessToken"),localStorage.removeItem("tab"),localStorage.removeItem("isLoggedIn"),this.$router.push("/login")},getUserOptions(){let e=[];this.options=[],setTimeout((()=>{for(let t=0;t<this.users.length;t++)e.push({id:this.users[t].id,label:this.users[t].name,avatar:this.users[t].avatar})}),100),this.options=e}},async beforeMount(){this.isLoading=!0;let e=this;S.addEventListener("open",(async function(e){S.send(JSON.stringify({accessToken:localStorage.getItem("accessToken").substring(7,localStorage.getItem("accessToken").length)}))})),S.addEventListener("message",(async function(t){const s=JSON.parse(t.data);if(s.messagesByRoomId&&await e.getChat({id:e.roomInfo.id,users:e.roomInfo.users,messages:s.messagesByRoomId}),s.messagePerRoom)for(let o=0;o<e.rooms.length;o++)e.rooms[o].id===s.messagePerRoom.messfinal.room_id&&e.rooms[o].messages.push(s.messagePerRoom.messfinal);s.rooms?(e.rooms=[],e.rooms=JSON.parse(t.data).rooms.rooms,e.chat&&localStorage.getItem("roomIndex")&&Number(localStorage.getItem("roomIndex"))>=0&&e.rooms.length>=Number(localStorage.getItem("roomIndex"))?(S.send(JSON.stringify({getMessagesByRoomId:{room_id:e.rooms[Number(localStorage.getItem("roomIndex"))].id}})),e.roomInfo=e.rooms[Number(localStorage.getItem("roomIndex"))]):(S.send(JSON.stringify({getMessagesByRoomId:{room_id:e.rooms[0].id}})),e.roomInfo=e.rooms[0],localStorage.setItem("roomIndex",0))):s.typing})),await this.getUser(),await this.getUsers(),this.getUserOptions(),this.isLoading=!1}};var Q=s(9214),C=s(3812),U=s(9570),z=s(3747),N=s(2165),R=s(2025),D=s(9721),L=s(5096),T=s(811),M=s(7011),O=s(3414),V=s(2035),P=s(2901),B=s(1289),H=s(3314),J=s(2350),E=s(7704),j=s(4689),A=s(4554),F=s(5869),K=s(2652),Y=s(677),$=s(860),G=s(7518),X=s.n(G);Z.render=x;const ee=Z;X()(Z,"components",{QLayout:Q.Z,QHeader:C.Z,QToolbar:U.Z,QToolbarTitle:z.Z,QBtn:N.Z,QSpace:R.Z,QBadge:D.Z,QAvatar:L.Z,QMenu:T.Z,QList:M.Z,QItem:O.Z,QItemSection:V.Z,QDrawer:P.Z,QPopupEdit:B.Z,QSelect:H.Z,QItemLabel:J.Z,QScrollArea:E.Z,QInput:j.Z,QIcon:A.Z,QSeparator:F.Z,QPageContainer:K.Z}),X()(Z,"directives",{ClosePopup:Y.Z,Ripple:$.Z})}}]);