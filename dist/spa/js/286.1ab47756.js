"use strict";(self["webpackChunkoc_front_end"]=self["webpackChunkoc_front_end"]||[]).push([[286],{8286:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var a=s(3673),n=s(2323),l=s(8880);const i={key:0,class:"flex"},o=["src"],r={key:0,class:"q-mt-sm q-ml-xs"},c={key:0,class:"q-mt-md"},d={class:"text-grey q-ma-none"},m={class:"q-mt-xl"},u={key:0,style:{width:"100% !important"}},p=["onClick"],g={key:0},h=["src"],y={key:0,class:"q-mb-xl"},w=["src"],f={key:0,class:"q-mb-xl"},_={style:{"margin-bottom":".5px !important"},class:"absolute-bottom"};function k(e,t,s,k,q,v){const b=(0,a.up)("q-avatar"),x=(0,a.up)("q-toolbar-title"),S=(0,a.up)("q-btn"),C=(0,a.up)("q-toolbar"),D=(0,a.up)("q-icon"),W=(0,a.up)("q-chat-message"),T=(0,a.up)("q-spinner-dots"),Z=(0,a.up)("q-scroll-area"),P=(0,a.up)("q-file"),Q=(0,a.up)("q-banner"),N=(0,a.up)("q-popup-proxy"),O=(0,a.up)("q-input"),J=(0,a.up)("q-page"),z=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(J,{class:"q-pa-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-primary bg-white absolute-top",style:{height:"54px !important"}},{default:(0,a.w5)((()=>[(0,a.Wm)(x,null,{default:(0,a.w5)((()=>[e.chat?((0,a.wg)(),(0,a.iD)("div",i,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.chat.users,((t,s)=>((0,a.wg)(),(0,a.iD)("div",{class:"flex q-mt-sm",key:t.id},[(0,a.wy)((0,a.Wm)(b,{class:(0,n.C_)(1===s&&"q-ml-xs"),size:"35px"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:t.avatar?t.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,o)])),_:2},1032,["class"]),[[l.F8,s<2]]),2===e.chat.users.length&&0===s?((0,a.wg)(),(0,a.iD)("div",r)):(0,a.kq)("",!0)])))),128)),e.chat.users?((0,a.wg)(),(0,a.iD)("div",c,[(0,a._)("p",d,(0,n.zw)(e.chat.users.length>2?"...+"+(e.chat.users.length-2):""),1)])):(0,a.kq)("",!0)])):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(S,{flat:"",round:"",dense:"",icon:"videocam"}),(0,a.Wm)(S,{flat:"",round:"",dense:"",icon:"call"})])),_:1}),(0,a._)("div",m,[(0,a.Wm)(Z,{ref:"scroll",style:{height:"80vh"},class:"scroll-center"},{default:(0,a.w5)((()=>[e.chat?((0,a.wg)(),(0,a.iD)("div",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.chat.messages,((t,s)=>((0,a.wg)(),(0,a.iD)("div",{key:t.id},[(0,a._)("div",null,[(0,a.Wm)(W,{name:t.user.name,avatar:e.user.id===t.user_id?e.user.avatar:t.user.avatar,class:(0,n.C_)(["q-pb-sm text-grey",e.user.id!==t.user_id&&"q-ml-xl"]),"bg-color":e.user.id!==t.user_id?"primary":"grey-4","text-color":e.user.id===t.user_id?"black":"white",sent:e.user.id===t.user_id,style:{"max-width":"90% !important","text-overflow":"break !important"},stamp:v.format(t.created_at)},{default:(0,a.w5)((()=>[(0,a._)("div",{onClick:e=>t.attachments[0]&&v.download(t.attachments[0]),class:(0,n.C_)([t.attachments[0]&&"text-grey","flex flex-center column"])},[(0,a.Uk)((0,n.zw)(0===t.attachments.length?t.text:"")+" ",1),t.attachments[0]?((0,a.wg)(),(0,a.iD)("div",g,[t.attachments[0].content_type.includes("image")?((0,a.wg)(),(0,a.iD)("img",{key:0,class:"q-mt-sm",height:"150",width:"150",src:t.attachments[0].url},null,8,h)):((0,a.wg)(),(0,a.j4)(b,{key:1,square:"",size:"100px"},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{color:"grey",name:"attach_file"})])),_:1}))])):(0,a.kq)("",!0)],10,p)])),_:2},1032,["name","avatar","class","bg-color","text-color","sent","stamp"]),s===e.chat.messages.length-1?((0,a.wg)(),(0,a.iD)("div",y,[(0,a._)("div",{class:(0,n.C_)(["q-ma-none flex",e.user.id!==t.user_id?"q-ml-xl":"q-mr-xl justify-end"])},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.messageRecipients,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.user.id},["delivered"===e.status?((0,a.wg)(),(0,a.j4)(b,{key:0,class:"q-ml-xs",size:"15px"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:e.user.avatar},null,8,w)])),_:2},1024)):(0,a.kq)("",!0)])))),128))],2)])):(0,a.kq)("",!0)]),s===e.chat.messages.length-1&&q.isTyping&&q.room_id===this.chat.id?((0,a.wg)(),(0,a.iD)("div",f,[(0,a.Wm)(T,{size:"md"})])):(0,a.kq)("",!0)])))),128))])):(0,a.kq)("",!0)])),_:1},512)]),(0,a._)("div",_,[(0,a.Wm)(O,{onInputCapture:v.typing,onKeydown:(0,l.D2)(v.send,["enter"]),outlined:"",square:"","bg-color":"white",modelValue:q.message,"onUpdate:modelValue":t[1]||(t[1]=e=>q.message=e),label:"Message"},{append:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(S,{color:"primary",onClick:v.send,round:"",dense:"",flat:"",icon:"send"},null,8,["onClick"]),[[l.F8,""!==q.message]])])),prepend:(0,a.w5)((()=>[(0,a.Wm)(S,{color:"primary",round:"",dense:"",flat:"",icon:"attachment"},{default:(0,a.w5)((()=>[(0,a.Wm)(N,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(P,{clearable:"",label:"File",outlined:"",modelValue:q.file,"onUpdate:modelValue":t[0]||(t[0]=e=>q.file=e)},{prepend:(0,a.w5)((()=>[(0,a.Wm)(D,{name:"attach_file"})])),_:1},8,["modelValue"]),(0,a.wy)((0,a.Wm)(S,{label:"Send",onClick:v.addMsgFile,"no-caps":"",disable:!q.file,flat:"",color:"primary",class:"q-mt-sm",size:"md"},null,8,["onClick","disable"]),[[z]])])),_:1})])),_:1})])),_:1})])),_:1},8,["onInputCapture","onKeydown","modelValue"])])])),_:1})}var q=s(6303),v=s(1082),b=s(3617),x=s(52),S=s.n(x);const C=new WebSocket("wss://oneconnect.it:4000"),D={data(){return{init:1,message:"",file:null,isTyping:!1,room_id:null,sender:[{type:"sender",message:"hey, how are you?"},{type:"receiver",message:"doing fine, how r you?"}]}},components:{breadcrmps:q.Z},computed:{...(0,b.rn)("chatStore",["chat"]),...(0,b.rn)("example",["user"])},methods:{...(0,b.nv)("example",["getUser"]),...(0,b.nv)("chatStore",["getChat","getMessage"]),format(e){return v.ZP.formatDate(e,"HH:mm")},typing(){C.send(JSON.stringify({typing:{room_id:Number(this.chat.id)}}))},download(e){window.open(e.url)},async addMsgFile(){let e=new FormData;e.append("files",this.file);let t=await S().post("https://onconnect-backend-api.herokuapp.com/api/v1/chats/addFiles/",e,{headers:{Authorization:localStorage.getItem("accessToken")}});t.data.success&&C.send(JSON.stringify({createMessage:{room_id:Number(this.chat.id),text:this.file.name,files:[t.data.data[0].id]}}))},setScrollPos(){this.$refs.scroll.setScrollPosition("vertical",1e19)},send(){if(""===this.message)return;let e=this;C.send(JSON.stringify({createMessage:{room_id:Number(this.chat.id),text:this.message}})),e.message="",setTimeout((()=>{e.setScrollPos()}),100)},receive(){setTimeout((()=>{self.setScrollPos()}),100)}},async mounted(){await this.getUser()},async mounted(){let e=this;C.addEventListener("open",(async function(e){C.send(JSON.stringify({accessToken:localStorage.getItem("accessToken").substring(7,localStorage.getItem("accessToken").length)}))})),C.addEventListener("message",(async function(t){1===e.init?e.init=2:JSON.parse(t.data).messagePerRoom?JSON.parse(t.data).messagePerRoom.messfinal.room_id===Number(e.chat.id)&&(await e.getMessage(JSON.parse(t.data).messagePerRoom.messfinal),e.setScrollPos()):JSON.parse(t.data).userTyping&&(e.room_id=JSON.parse(t.data).userTyping.room_id,e.isTyping=!0,setTimeout((()=>{e.isTyping=!1}),2e3)),e.setScrollPos()}))},setup(){return{crumps:[{id:1,name:"OneConnect",icon:"home",path:"/"},{id:2,name:"Chat",icon:"chat",path:"/chat"}]}}};var W=s(4379),T=s(9570),Z=s(3747),P=s(5096),Q=s(2165),N=s(7704),O=s(629),J=s(4554),z=s(4765),F=s(4689),M=s(3944),I=s(5607),V=s(4974),H=s(677),K=s(7518),U=s.n(K);D.render=k;const j=D;U()(D,"components",{QPage:W.Z,QToolbar:T.Z,QToolbarTitle:Z.Z,QAvatar:P.Z,QBtn:Q.Z,QScrollArea:N.Z,QChatMessage:O.Z,QIcon:J.Z,QSpinnerDots:z.Z,QInput:F.Z,QPopupProxy:M.Z,QBanner:I.Z,QFile:V.Z}),U()(D,"directives",{ClosePopup:H.Z})}}]);