"use strict";(self["webpackChunkoc_front_end"]=self["webpackChunkoc_front_end"]||[]).push([[441],{7441:(e,t,a)=>{a.r(t),a.d(t,{default:()=>H});var s=a(3673),n=a(2323),i=a(8880);const l={key:0,class:"flex"},o=["src"],r={key:0,id:"room-container",style:{width:"100% !important",height:"100vh","overflow-y":"scroll !important","padding-top":"54px !important"}},c={class:"q-pr-xl q-pl-xl"},d=["onClick"],m={key:0},u=["src"],p=["src"],g={key:0,class:"q-pb-xl"},h=["src"],y={class:"absolute-bottom"};function w(e,t,a,w,f,_){const v=(0,s.up)("q-avatar"),x=(0,s.up)("q-toolbar-title"),k=(0,s.up)("q-btn"),b=(0,s.up)("q-toolbar"),q=(0,s.up)("q-icon"),S=(0,s.up)("q-chat-message"),C=(0,s.up)("q-spinner-dots"),T=(0,s.up)("q-file"),W=(0,s.up)("q-banner"),D=(0,s.up)("q-popup-proxy"),N=(0,s.up)("q-input"),Z=(0,s.up)("q-page"),Q=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.j4)(Z,{style:{height:"600px !important"}},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{class:"text-primary bg-white absolute-top",style:{height:"54px !important","z-index":"5"}},{default:(0,s.w5)((()=>[(0,s.Wm)(x,null,{default:(0,s.w5)((()=>[e.chat?((0,s.wg)(),(0,s.iD)("div",l,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.chat.users,((t,a)=>((0,s.wg)(),(0,s.iD)("div",{class:"flex q-mt-sm",key:t.id},[(0,s.wy)((0,s.Wm)(v,{class:(0,n.C_)(1===a&&"q-ml-xs"),size:"35px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:t.avatar?t.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,o)])),_:2},1032,["class"]),[[i.F8,a<2]]),(0,s.wy)((0,s.Wm)(v,{class:"q-ml-xs bg-grey-3 text-grey",size:"35px"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)("+"+(e.chat.users.length-2)),1)])),_:2},1536),[[i.F8,2===a&&e.chat.users.length>2]])])))),128))])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(k,{flat:"",round:"",dense:"",icon:"videocam"}),(0,s.Wm)(k,{flat:"",round:"",dense:"",icon:"call"})])),_:1}),(0,s._)("div",null,[e.chat?((0,s.wg)(),(0,s.iD)("div",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.chat.messages,((t,a)=>((0,s.wg)(),(0,s.iD)("div",{key:t.id},[(0,s._)("div",c,[(0,s.Wm)(S,{name:t.user.name,avatar:e.user.id===t.user_id?e.user.avatar:t.user.avatar,size:"35",class:(0,n.C_)([a!==e.chat.messages.length-1&&"q-pb-md","text-grey"]),"bg-color":e.user.id!==t.user_id?"primary":"grey-4","text-color":e.user.id===t.user_id?"black":"white",sent:e.user.id===t.user_id,style:{"max-width":"100% !important","text-overflow":"break !important"},stamp:_.format(t.created_at)},{default:(0,s.w5)((()=>[(0,s._)("div",{onClick:e=>t.attachments[0]&&_.download(t.attachments[0]),class:(0,n.C_)([t.attachments[0]&&"text-grey","flex flex-center column"])},[(0,s.Uk)((0,n.zw)(0===t.attachments.length?t.text:"")+" ",1),t.attachments[0]?((0,s.wg)(),(0,s.iD)("div",m,[t.attachments[0].content_type.includes("image")?((0,s.wg)(),(0,s.iD)("img",{key:0,class:"q-mt-sm",height:"150",width:"150",src:t.attachments[0].url},null,8,u)):((0,s.wg)(),(0,s.j4)(v,{key:1,square:"",size:"100px"},{default:(0,s.w5)((()=>[(0,s.Wm)(q,{color:"grey",name:"attach_file"})])),_:1}))])):(0,s.kq)("",!0)],10,d)])),_:2},1032,["name","avatar","class","bg-color","text-color","sent","stamp"]),a===e.chat.messages.length-1?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"q-mb-xl",style:(0,n.j5)(a===e.chat.messages.length-1&&"padding-bottom:60px;")},[(0,s._)("div",{class:(0,n.C_)(["q-ma-none flex",e.user.id!==t.user_id?"q-ml-xl":"q-mr-xl justify-end"])},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.messageRecipients,(a=>((0,s.wg)(),(0,s.iD)("div",{key:a.user.id},["seen"===a.status&&a.user_id!==e.user.id&&t.user.id!==a.user_id?((0,s.wg)(),(0,s.j4)(v,{key:0,class:"q-ml-xs",size:"15px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:a.user.avatar?a.user.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,p)])),_:2},1024)):(0,s.kq)("",!0)])))),128))],2),a===e.chat.messages.length-1&&f.isTyping&&f.room_id===this.chat.id?((0,s.wg)(),(0,s.iD)("div",g,[(0,s.Wm)(v,{size:"22px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:f.avatar?f.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,h)])),_:1}),(0,s.Wm)(C,{class:"q-ml-sm",size:"xs"})])):(0,s.kq)("",!0)],4)):(0,s.kq)("",!0)])])))),128))])):(0,s.kq)("",!0)]),(0,s._)("div",y,[(0,s.Wm)(N,{onInputCapture:_.typing,onKeydown:(0,i.D2)(_.send,["enter"]),outlined:"",square:"","bg-color":"white",modelValue:f.message,"onUpdate:modelValue":t[1]||(t[1]=e=>f.message=e),label:"Message"},{append:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(k,{color:"primary",onClick:_.send,round:"",dense:"",flat:"",icon:"send"},null,8,["onClick"]),[[i.F8,""!==f.message]])])),prepend:(0,s.w5)((()=>[(0,s.Wm)(k,{color:"primary",round:"",dense:"",flat:"",icon:"attachment"},{default:(0,s.w5)((()=>[(0,s.Wm)(D,null,{default:(0,s.w5)((()=>[(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[(0,s.Wm)(T,{clearable:"",label:"File",outlined:"",modelValue:f.file,"onUpdate:modelValue":t[0]||(t[0]=e=>f.file=e)},{prepend:(0,s.w5)((()=>[(0,s.Wm)(q,{name:"attach_file"})])),_:1},8,["modelValue"]),(0,s.wy)((0,s.Wm)(k,{label:"Send",onClick:_.addMsgFile,"no-caps":"",disable:!f.file,flat:"",color:"primary",class:"q-mt-sm",size:"md"},null,8,["onClick","disable"]),[[Q]])])),_:1})])),_:1})])),_:1})])),_:1},8,["onInputCapture","onKeydown","modelValue"])])])),_:1})}var f=a(6303),_=a(1082),v=a(3617),x=a(52),k=a.n(x);const b=new WebSocket("wss://oneconnect.it:4000"),q={data(){return{init:1,message:"",file:null,isTyping:!1,avatar:null,room_id:null,sender:[{type:"sender",message:"hey, how are you?"},{type:"receiver",message:"doing fine, how r you?"}]}},components:{breadcrmps:f.Z},computed:{...(0,v.rn)("chatStore",["chat"]),...(0,v.rn)("example",["user"])},methods:{...(0,v.nv)("example",["getUser"]),...(0,v.nv)("chatStore",["getChat","getMessage"]),format(e){return _.ZP.formatDate(e,"HH:mm")},typing(){b.send(JSON.stringify({typing:{room_id:Number(this.chat.id)}}))},download(e){window.open(e.url)},async addMsgFile(){let e=new FormData;e.append("files",this.file);let t=await k().post("https://onconnect-backend-api.herokuapp.com/api/v1/chats/addFiles/",e,{headers:{Authorization:localStorage.getItem("accessToken")}});t.data.success&&b.send(JSON.stringify({createMessage:{room_id:Number(this.chat.id),text:this.file.name,files:[t.data.data[0].id]}}))},setScrollPos(){},updateScroll(){var e=document.getElementById("room-container");e.scrollTop=e.scrollHeight},send(){if(""===this.message)return;let e=this;b.send(JSON.stringify({createMessage:{room_id:Number(this.chat.id),text:this.message}})),e.message="",setTimeout((()=>{e.updateScroll()}),100)},receive(){setTimeout((()=>{self.updateScroll()}),100)}},async mounted(){await this.getUser()},async mounted(){let e=this;b.addEventListener("open",(async function(e){b.send(JSON.stringify({accessToken:localStorage.getItem("accessToken").substring(7,localStorage.getItem("accessToken").length)}))})),b.addEventListener("message",(async function(t){1===e.init?e.init=2:JSON.parse(t.data).messagePerRoom?JSON.parse(t.data).messagePerRoom.messfinal.room_id===Number(e.chat.id)&&(await e.getMessage(JSON.parse(t.data).messagePerRoom.messfinal),e.updateScroll()):JSON.parse(t.data).userTyping&&(e.room_id=JSON.parse(t.data).userTyping.room_id,e.isTyping=JSON.parse(t.data).userTyping,e.avatar=JSON.parse(t.data).userTyping.avatar,setTimeout((()=>{e.isTyping=!1,e.avatar=null}),2e3)),JSON.parse(t.data).onlineUsers||e.updateScroll()}))},setup(){return{crumps:[{id:1,name:"OneConnect",icon:"home",path:"/"},{id:2,name:"Chat",icon:"chat",path:"/chat"}]}}};var S=a(4379),C=a(9570),T=a(3747),W=a(5096),D=a(2165),N=a(7704),Z=a(629),Q=a(4554),O=a(4765),z=a(4689),J=a(3944),F=a(5607),P=a(4974),I=a(677),M=a(7518),U=a.n(M);q.render=w;const H=q;U()(q,"components",{QPage:S.Z,QToolbar:C.Z,QToolbarTitle:T.Z,QAvatar:W.Z,QBtn:D.Z,QScrollArea:N.Z,QChatMessage:Z.Z,QIcon:Q.Z,QSpinnerDots:O.Z,QInput:z.Z,QPopupProxy:J.Z,QBanner:F.Z,QFile:P.Z}),U()(q,"directives",{ClosePopup:I.Z})}}]);