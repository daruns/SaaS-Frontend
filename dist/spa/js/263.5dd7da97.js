"use strict";(self["webpackChunkoc_front_end"]=self["webpackChunkoc_front_end"]||[]).push([[263],{263:(e,s,o)=>{o.r(s),o.d(s,{default:()=>te});var t=o(3673),l=o(2323),a=o(8880),r=o(3402),i=o.n(r);const n=(0,t._)("img",{alt:"oneconnect logo",src:i(),style:{height:"30px",width:"30px"}},null,-1),m={class:"flex flex-center q-mr-sm"},d=(0,t.Uk)("4"),u=(0,t.Uk)("2"),c=["src"],g=(0,t.Uk)("Settings"),p=(0,t.Uk)("Log out"),f=["src"],h={key:0,class:"q-pa-md text-grey"},w={class:"flex"},b=["src"],_={class:"q-mt-sm text-grey"},y={key:0,class:"fit flex items-center q-pl-md justify-start column bg-grey-1"},W={class:"row full-width"},v=["src"],k={class:"text-h6 q-ma-none text-grey"},I=["src"];function x(e,s,o,r,i,x){const q=(0,t.up)("q-btn"),S=(0,t.up)("q-space"),U=(0,t.up)("q-badge"),C=(0,t.up)("q-avatar"),Z=(0,t.up)("q-item-section"),Q=(0,t.up)("q-item"),N=(0,t.up)("q-list"),V=(0,t.up)("q-menu"),z=(0,t.up)("q-toolbar-title"),R=(0,t.up)("q-toolbar"),D=(0,t.up)("q-header"),M=(0,t.up)("q-item-label"),T=(0,t.up)("q-select"),O=(0,t.up)("q-popup-edit"),J=(0,t.up)("q-icon"),L=(0,t.up)("q-input"),B=(0,t.up)("q-separator"),P=(0,t.up)("q-scroll-area"),H=(0,t.up)("q-drawer"),E=(0,t.up)("router-view"),j=(0,t.up)("q-page-container"),F=(0,t.up)("q-layout"),A=(0,t.up)("confirm"),K=(0,t.up)("q-dialog"),Y=(0,t.Q2)("close-popup"),$=(0,t.Q2)("ripple");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t.Wm)(F,{view:"hHh lpR fFf",container:"",style:{height:"100vh"},class:"shadow-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{class:"primary"},{default:(0,t.w5)((()=>[(0,t.Wm)(R,{class:"bg-primary text-white shadow-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{class:"flex"},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{flat:"",round:"",icon:"menu",onClick:s[0]||(s[0]=e=>i.drawer=!i.drawer)}),(0,t.Wm)(q,{flat:"",round:"",icon:"chevron_left",to:"/"}),(0,t.Wm)(q,{flat:"",round:""},{default:(0,t.w5)((()=>[n])),_:1}),(0,t.Wm)(S),(0,t._)("div",m,[(0,t.Wm)(q,{flat:"",color:"white",round:"",icon:"email",size:"sm"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{color:"red",rounded:"",floating:""},{default:(0,t.w5)((()=>[d])),_:1})])),_:1}),(0,t.Wm)(q,{flat:"",color:"white",round:"",icon:"notifications",size:"sm"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{rounded:"",color:"red",floating:""},{default:(0,t.w5)((()=>[u])),_:1})])),_:1})]),(0,t.Wm)(q,{flat:"",round:"",icon:"menu_open",onClick:s[1]||(s[1]=e=>i.drawer1=!i.drawer1)}),(0,t.Wm)(q,{flat:"",round:""},{default:(0,t.w5)((()=>[null!==e.user.avatar?((0,t.wg)(),(0,t.iD)("img",{key:0,alt:"User logo",src:e.user.avatar,style:{height:"30px",width:"30px","border-radius":"50%"}},null,8,c)):((0,t.wg)(),(0,t.j4)(C,{key:1,size:"30px","font-size":"10px",color:"grey","text-color":"white",icon:"person"})),(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Wm)(N,null,{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(Q,{to:"/profile",clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[g])),_:1})])),_:1},512),[[Y]]),(0,t.Wm)(Q,{clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{onClick:x.logout},{default:(0,t.w5)((()=>[p])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,t.Wm)(H,{modelValue:i.drawer,"onUpdate:modelValue":s[4]||(s[4]=e=>i.drawer=e),"show-if-above":"",width:300,breakpoint:1185},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{round:"",icon:"add",class:"absolute-bottom-right q-mr-sm q-mb-sm",color:"primary",style:{"z-index":"10 !important"}},{default:(0,t.w5)((()=>[(0,t.Wm)(O,{modelValue:i.members,"onUpdate:modelValue":s[3]||(s[3]=e=>i.members=e),style:{"min-width":"15rem !important"},cover:!1,offset:[0,10]},{default:(0,t.w5)((e=>[(0,t.Wm)(T,{ref:"clientRef",rules:[e=>null!==e||"This field is required"],"bg-color":"white",outlined:"",counter:"",multiple:"","use-chips":"",loading:i.isLoading,modelValue:i.members,"onUpdate:modelValue":s[2]||(s[2]=e=>i.members=e),options:i.options,label:"Choose members"},{option:(0,t.w5)((e=>[(0,t.Wm)(Q,(0,l.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"avatar-list"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{class:"q-mr-xs",size:"30px"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:e.opt.avatar?e.opt.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,f)])),_:2},1024),(0,t.Wm)(M,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:2},1032,["rules","loading","modelValue","options"]),(0,t.wy)((0,t.Wm)(q,{onClick:x.addMembs,"no-caps":"",flat:"",label:"submit",color:"primary",disable:0===i.members.length},null,8,["onClick","disable"]),[[Y]])])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(P,{ref:"scrollAreaRef",style:{height:"100%","border-right":"1px solid #ddd"}},{default:(0,t.w5)((()=>[(0,t.Wm)(N,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Q,{style:{position:"sticky",top:"0","z-index":"5","background-color":"white"}},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{class:"full-width",outlined:"",label:"Search"},{prepend:(0,t.w5)((()=>[(0,t.Wm)(J,{name:"search",class:"q-ml-sm"})])),_:1})])),_:1}),0===i.rooms.length?((0,t.wg)(),(0,t.iD)("div",h,"No rooms to show!")):((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(i.rooms,((s,o)=>((0,t.wg)(),(0,t.iD)("div",{key:o},[(0,t.wy)((0,t.Wm)(Q,{class:(0,l.C_)(s.id===e.chat.id?"bg-blue-1":""),style:(0,l.j5)(s.id===e.chat.id?"border: .5px solid skyblue":""),onClick:e=>x.getMessages(s,o),clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(M,null,{default:(0,t.w5)((()=>[(0,t._)("div",w,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(s.users,((e,s)=>((0,t.wg)(),(0,t.iD)("div",{class:"text-ellipses",key:e.id},[(0,t.wy)((0,t.Wm)(C,{class:(0,l.C_)(1===s&&"q-ml-xs"),size:"25px"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:e.avatar?e.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,b)])),_:2},1032,["class"]),[[a.F8,s<2]])])))),128)),(0,t._)("p",_,(0,l.zw)(s.users.length>2?"...+"+(s.users.length-2):""),1)])])),_:2},1024),(0,t.Wm)(M,{class:(0,l.C_)(s.users.length<2||2===s.users.length?"q-pt-md":""),caption:"",lines:"1"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(0!==s.messages.length?s.messages[s.messages.length-1].text:"No messages!"),1)])),_:2},1032,["class"])])),_:2},1024),(0,t.Wm)(Z,{side:"",top:""},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(0!==s.messages.length?x.format(s.messages[s.messages.length-1].created_at):""),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","style","onClick"]),[[$]]),(0,t.Wm)(B)])))),128))])),_:1})])),_:1},512)])),_:1},8,["modelValue"]),(0,t.Wm)(H,{"show-if-above":"",side:"right",bordered:"",modelValue:i.drawer1,"onUpdate:modelValue":s[7]||(s[7]=e=>i.drawer1=e),width:350,breakpoint:1185,class:"bg-grey-1",style:{"overflow-y":"hidden !important"}},{default:(0,t.w5)((()=>[e.chat?((0,t.wg)(),(0,t.iD)("div",y,[(0,t._)("div",W,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(i.allUsers,(s=>((0,t.wg)(),(0,t.iD)("div",{key:s.id,class:"flex column flex-center q-ma-sm"},[(0,t.Wm)(C,{size:"75px"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{rounded:"",color:s.online?"green":"grey-5",class:"absolute-bottom-right q-mr-sm"},null,8,["color"]),i.roomInfo&&e.user.id===i.roomInfo.creator_id||s.id===e.user.id?((0,t.wg)(),(0,t.j4)(q,{key:0,round:"",size:"5px",onClick:e=>{i.membToDelete=s.id,i.cnfrm=!0},icon:"close",color:"negative",class:"absolute-top-right"},null,8,["onClick"])):(0,t.kq)("",!0),(0,t._)("img",{src:s.avatar?s.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,v)])),_:2},1024),(0,t._)("p",k,(0,l.zw)(s.name),1)])))),128))])])):(0,t.kq)("",!0),(0,t.Wm)(q,{round:"",icon:"add",class:"absolute-bottom-left q-ml-sm q-mb-sm",color:"primary",style:{"z-index":"10 !important"}},{default:(0,t.w5)((()=>[(0,t.Wm)(O,{modelValue:i.members,"onUpdate:modelValue":s[6]||(s[6]=e=>i.members=e),style:{"min-width":"15rem !important"},cover:!1,offset:[0,10]},{default:(0,t.w5)((e=>[(0,t.Wm)(T,{ref:"clientRef",rules:[e=>null!==e||"This field is required"],"bg-color":"white",outlined:"",counter:"",multiple:"","use-chips":"",loading:i.isLoading,modelValue:i.members1,"onUpdate:modelValue":s[5]||(s[5]=e=>i.members1=e),options:i.options1,label:"Choose members"},{option:(0,t.w5)((e=>[(0,t.Wm)(Q,(0,l.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"avatar-list"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{class:"q-mr-xs",size:"30px"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:e.opt.avatar?e.opt.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,I)])),_:2},1024),(0,t.Wm)(M,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:2},1032,["rules","loading","modelValue","options"]),(0,t.wy)((0,t.Wm)(q,{onClick:x.addNewMembers,"no-caps":"",flat:"",label:"submit",color:"primary",disable:0===i.members1.length},null,8,["onClick","disable"]),[[Y]])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(j,null,{default:(0,t.w5)((()=>[(0,t.Wm)(E)])),_:1})])),_:1}),(0,t.Wm)(K,{modelValue:i.cnfrm,"onUpdate:modelValue":s[8]||(s[8]=e=>i.cnfrm=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(A,{onConfirm:x.deleteMemeber},null,8,["onConfirm"])])),_:1},8,["modelValue"])])}var q=o(1082),S=o(3617),U=o(1887);const C=new WebSocket("wss://oneconnect.it:4000"),Z={data(){return{isLoggedIn:localStorage.getItem("accessToken"),isExpanded:!0,isExpanded2:!0,membToDelete:null,members:[],options:[],members1:[],options1:[],onlineUsers:[],allUsers:[],rooms:[],roomInfo:null,isLoading:!1,drawer:!1,drawer1:!1,cnfrm:!1}},computed:{...(0,S.rn)("example",["user"]),...(0,S.rn)("userStore",["users"]),...(0,S.rn)("chatStore",["chat"])},components:{confirm:U.Z},methods:{...(0,S.nv)("userStore",["getUsers"]),...(0,S.nv)("example",["getUser"]),...(0,S.nv)("chatStore",["getChat","clearChat"]),addNewMembers(){let e=this,s=[];for(let o=0;o<this.members1.length;o++)s.push(this.members1[o].id);C.send(JSON.stringify({addRoomUsers:{id:e.chat.id,users:s}})),s=[],this.members1=[]},deleteMemeber(){let e=this;C.send(JSON.stringify({deleteRoomUsers:{id:e.chat.id,users:[e.membToDelete]}})),this.membToDelete=null,this.cnfrm=!1},async getMessages(e,s){document.body.offsetWidth<=1185&&(this.drawer=!1),localStorage.setItem("roomIndex",s),this.roomInfo=e,C.send(JSON.stringify({getMessagesByRoomId:{room_id:e.id}}))},getMessagesImmediate(){let e=this;C.send(JSON.stringify({getMessagesByRoomId:{room_id:Number(e.chat.id)}}))},format(e){return q.ZP.formatDate(e,"HH:mm")},addMembs(){let e=[];for(let s=0;s<this.members.length;s++)e.push(Number(this.members[s].id));C.send(JSON.stringify({createRoom:{users:e}})),e=[],this.members=[]},logout(){localStorage.removeItem("accessToken"),localStorage.removeItem("tab"),localStorage.removeItem("isLoggedIn"),this.$router.push("/login")},getUserOptions(){let e=[];this.options=[],setTimeout((()=>{for(let s=0;s<this.users.length;s++)e.push({id:this.users[s].id,label:this.users[s].name,avatar:this.users[s].avatar})}),100),this.options=e,this.options1=e}},async beforeMount(){this.isLoading=!0;let e=this;C.addEventListener("open",(async function(e){C.send(JSON.stringify({accessToken:localStorage.getItem("accessToken").substring(7,localStorage.getItem("accessToken").length)}))})),C.addEventListener("message",(async function(s){const o=JSON.parse(s.data);if(o.onlineUsers){e.onlineUsers=o.onlineUsers;let s=e.chat.users.filter((({id:e})=>!o.onlineUsers.some((({id:s})=>s===e)))),t=e.chat.users.filter((({id:e})=>o.onlineUsers.some((({id:s})=>s===e))));e.allUsers=[];for(let o=0;o<t.length;o++)e.allUsers.push({...t[o],online:!0});for(let o=0;o<s.length;o++)e.allUsers.push({...s[o],online:!1})}if(o.messagesByRoomId&&e.roomInfo.id===o.messagesByRoomId.room_id&&(await e.getChat({id:e.roomInfo.id,users:e.roomInfo.users,messages:o.messagesByRoomId.roomMessages}),C.send(JSON.stringify({ping:!0}))),o.messagePerRoom)for(let t=0;t<e.rooms.length;t++)e.rooms[t].id===o.messagePerRoom.messfinal.room_id&&(e.rooms[t].messages.push(o.messagePerRoom.messfinal),await e.getMessagesImmediate());if(o.rooms){if(e.rooms=[],e.rooms=JSON.parse(s.data).rooms.rooms,0===e.rooms.length)return void await e.clearChat();e.chat&&localStorage.getItem("roomIndex")&&Number(localStorage.getItem("roomIndex"))>=0&&e.rooms.length>=Number(localStorage.getItem("roomIndex"))?(setTimeout((()=>{C.send(JSON.stringify({getMessagesByRoomId:{room_id:e.rooms[Number(localStorage.getItem("roomIndex"))].id}}))}),100),e.roomInfo=e.rooms[Number(localStorage.getItem("roomIndex"))]):(C.send(JSON.stringify({getMessagesByRoomId:{room_id:e.rooms[0].id}})),e.roomInfo=e.rooms[0],localStorage.setItem("roomIndex",0))}else o.typing})),await this.getUser(),await this.getUsers(),this.getUserOptions(),this.isLoading=!1,C.send(JSON.stringify({ping:!0})),setInterval((()=>{C.send(JSON.stringify({ping:!0}))}),1e4)}};var Q=o(9214),N=o(3812),V=o(9570),z=o(3747),R=o(2165),D=o(2025),M=o(9721),T=o(5096),O=o(811),J=o(7011),L=o(3414),B=o(2035),P=o(2901),H=o(1289),E=o(3314),j=o(2350),F=o(7704),A=o(4689),K=o(4554),Y=o(5869),$=o(2652),G=o(6778),X=o(677),ee=o(860),se=o(7518),oe=o.n(se);Z.render=x;const te=Z;oe()(Z,"components",{QLayout:Q.Z,QHeader:N.Z,QToolbar:V.Z,QToolbarTitle:z.Z,QBtn:R.Z,QSpace:D.Z,QBadge:M.Z,QAvatar:T.Z,QMenu:O.Z,QList:J.Z,QItem:L.Z,QItemSection:B.Z,QDrawer:P.Z,QPopupEdit:H.Z,QSelect:E.Z,QItemLabel:j.Z,QScrollArea:F.Z,QInput:A.Z,QIcon:K.Z,QSeparator:Y.Z,QPageContainer:$.Z,QDialog:G.Z}),oe()(Z,"directives",{ClosePopup:X.Z,Ripple:ee.Z})}}]);