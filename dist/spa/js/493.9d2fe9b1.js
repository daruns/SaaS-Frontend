"use strict";(self["webpackChunkoc_front_end"]=self["webpackChunkoc_front_end"]||[]).push([[493],{4493:(e,a,t)=>{t.r(a),t.d(a,{default:()=>re});var s=t(3673),n=t(2323),l=t(8880);const i={key:0,class:"flex"},r={key:0,class:"flex"},o={key:0,class:"flex items-center"},c=["src"],m={class:"q-ma-none q-pb-none text-subtitle1 q-ml-sm text-black"},d={key:1,class:"flex"},u={class:"flex"},p=["src"],g={key:2,class:"flex"},h={class:"flex items-center"},y=["src"],w={class:"q-ma-none text-subtitle1 q-ml-sm text-black"},f={key:3,class:"flex"},_={class:"flex items-center"},x=["src"],v={class:"flex"},k={key:0,class:"text-black text-subtitle1 q-mr-none q-mt-none q-mb-none q-ml-sm"},q={key:1,class:"q-ma-none text-black text-subtitle1"},b={key:0,class:"q-ma-none text-black text-subtitle1"},D={key:4,class:"flex"},S={class:"flex items-center"},W={class:"q-ma-none q-pa-none text-subtitle1 q-ml-sm text-grey"},C={key:0,id:"room-container",style:{width:"100% !important",height:"100vh","overflow-y":"scroll !important","padding-top":"54px !important"}},z={class:"q-pr-xl q-pl-xl"},T=["onClick"],N={key:0},Z=["src"],Q=["src"],O={key:0,class:"q-pb-xl"},J=["src"],F={class:"absolute-bottom"};function P(e,a,t,P,H,I){const M=(0,s.up)("q-avatar"),K=(0,s.up)("q-toolbar-title"),U=(0,s.up)("q-btn"),V=(0,s.up)("q-toolbar"),j=(0,s.up)("q-icon"),Y=(0,s.up)("q-chat-message"),R=(0,s.up)("q-spinner-dots"),A=(0,s.up)("q-file"),B=(0,s.up)("q-banner"),E=(0,s.up)("q-popup-proxy"),L=(0,s.up)("q-input"),G=(0,s.up)("q-page"),X=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.j4)(G,{style:{height:"600px !important"}},{default:(0,s.w5)((()=>[(0,s.Wm)(V,{class:"text-primary bg-white absolute-top",style:{height:"54px !important","z-index":"5"}},{default:(0,s.w5)((()=>[(0,s.Wm)(K,null,{default:(0,s.w5)((()=>[e.chat?((0,s.wg)(),(0,s.iD)("div",i,["chat"===e.chat.room_type?((0,s.wg)(),(0,s.iD)("div",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.chat.users,((a,t)=>((0,s.wg)(),(0,s.iD)("div",{key:a.id},[a.id!==e.user.id?((0,s.wg)(),(0,s.iD)("div",o,[(0,s.wy)((0,s.Wm)(M,{class:(0,n.C_)(1===t&&"q-ml-xs"),size:"35px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:a.avatar?a.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,c)])),_:2},1032,["class"]),[[l.F8,t<2]]),(0,s._)("p",m,(0,n.zw)(a.name),1)])):(0,s.kq)("",!0)])))),128))])):"channel"!==e.chat.room_type||e.chat.avatar||e.chat.name?"channel"===e.chat.room_type&&e.chat.avatar&&e.chat.name?((0,s.wg)(),(0,s.iD)("div",g,[(0,s._)("div",h,[(0,s.Wm)(M,{size:"35px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:e.chat.avatar},null,8,y)])),_:1}),(0,s._)("p",w,(0,n.zw)(e.chat.name),1)])])):"channel"===e.chat.room_type&&e.chat.avatar&&!e.chat.name?((0,s.wg)(),(0,s.iD)("div",f,[(0,s._)("div",_,[(0,s.Wm)(M,{size:"35px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:e.chat.avatar},null,8,x)])),_:1}),(0,s._)("div",v,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.chat.users,((e,a)=>((0,s.wg)(),(0,s.iD)("div",{class:"flex",key:e.id},[a<2?((0,s.wg)(),(0,s.iD)("p",k,(0,n.zw)(e.name),1)):(0,s.kq)("",!0),a<1?((0,s.wg)(),(0,s.iD)("p",q,",")):(0,s.kq)("",!0)])))),128)),e.chat.users.length>2?((0,s.wg)(),(0,s.iD)("p",b,"...")):(0,s.kq)("",!0)])])])):"channel"===e.chat.room_type&&e.chat.name&&!e.chat.avatar?((0,s.wg)(),(0,s.iD)("div",D,[(0,s._)("div",S,[(0,s._)("p",W,(0,n.zw)(e.chat.name),1)])])):(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",d,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.chat.users,((a,t)=>((0,s.wg)(),(0,s.iD)("div",{key:a.id},[(0,s._)("div",u,[(0,s.wy)((0,s.Wm)(M,{class:(0,n.C_)(1===t&&"q-ml-xs"),size:"35px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:a.avatar?a.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,p)])),_:2},1032,["class"]),[[l.F8,t<2]]),(0,s.wy)((0,s.Wm)(M,{class:"q-ml-xs bg-grey-3 text-grey",size:"35px"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)("+"+(e.chat.users.length-2)),1)])),_:2},1536),[[l.F8,2===t&&e.chat.users.length>2]])])])))),128))]))])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(U,{flat:"",round:"",dense:"",icon:"videocam"}),(0,s.Wm)(U,{flat:"",round:"",dense:"",icon:"call"})])),_:1}),(0,s._)("div",null,[e.chat?((0,s.wg)(),(0,s.iD)("div",C,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.chat.messages,((a,t)=>((0,s.wg)(),(0,s.iD)("div",{key:a.id},[(0,s._)("div",z,[(0,s.Wm)(Y,{name:a.user.name,avatar:e.user.id===a.user_id?e.user.avatar:a.user.avatar,size:"35",class:(0,n.C_)([t!==e.chat.messages.length-1&&"q-pb-md","text-grey"]),"bg-color":e.user.id!==a.user_id?"primary":"grey-4","text-color":e.user.id===a.user_id?"black":"white",sent:e.user.id===a.user_id,style:{"max-width":"100% !important","text-overflow":"break !important"},stamp:I.format(a.created_at)},{default:(0,s.w5)((()=>[(0,s._)("div",{onClick:e=>a.attachments[0]&&I.download(a.attachments[0]),class:(0,n.C_)([a.attachments[0]&&"text-grey","flex flex-center column"])},[(0,s.Uk)((0,n.zw)(0===a.attachments.length?a.text:"")+" ",1),a.attachments[0]?((0,s.wg)(),(0,s.iD)("div",N,[a.attachments[0].content_type.includes("image")?((0,s.wg)(),(0,s.iD)("img",{key:0,class:"q-mt-sm",height:"150",width:"150",src:a.attachments[0].url},null,8,Z)):((0,s.wg)(),(0,s.j4)(M,{key:1,square:"",size:"100px"},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{color:"grey",name:"attach_file"})])),_:1}))])):(0,s.kq)("",!0)],10,T)])),_:2},1032,["name","avatar","class","bg-color","text-color","sent","stamp"]),t===e.chat.messages.length-1?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"q-mb-xl",style:(0,n.j5)(t===e.chat.messages.length-1&&"padding-bottom:60px;")},[(0,s._)("div",{class:(0,n.C_)(["q-ma-none flex",e.user.id!==a.user_id?"q-ml-xl":"q-mr-xl justify-end"])},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.messageRecipients,(t=>((0,s.wg)(),(0,s.iD)("div",{key:t.user.id},["seen"===t.status&&t.user_id!==e.user.id&&a.user.id!==t.user_id?((0,s.wg)(),(0,s.j4)(M,{key:0,class:"q-ml-xs",size:"15px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:t.user.avatar?t.user.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,Q)])),_:2},1024)):(0,s.kq)("",!0)])))),128))],2),t===e.chat.messages.length-1&&H.isTyping&&H.room_id===this.chat.id?((0,s.wg)(),(0,s.iD)("div",O,[(0,s.Wm)(M,{size:"22px"},{default:(0,s.w5)((()=>[(0,s._)("img",{src:H.avatar?H.avatar:"https://cdn-icons-png.flaticon.com/512/149/149071.png"},null,8,J)])),_:1}),(0,s.Wm)(R,{class:"q-ml-sm",size:"xs"})])):(0,s.kq)("",!0)],4)):(0,s.kq)("",!0)])])))),128))])):(0,s.kq)("",!0)]),(0,s._)("div",F,[(0,s.Wm)(L,{onInputCapture:I.typing,onKeydown:(0,l.D2)(I.send,["enter"]),outlined:"",square:"","bg-color":"white",modelValue:H.message,"onUpdate:modelValue":a[1]||(a[1]=e=>H.message=e),label:"Message"},{append:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(U,{color:"primary",onClick:I.send,round:"",dense:"",flat:"",icon:"send"},null,8,["onClick"]),[[l.F8,""!==H.message]])])),prepend:(0,s.w5)((()=>[(0,s.Wm)(U,{color:"primary",round:"",dense:"",flat:"",icon:"attachment"},{default:(0,s.w5)((()=>[(0,s.Wm)(E,null,{default:(0,s.w5)((()=>[(0,s.Wm)(B,null,{default:(0,s.w5)((()=>[(0,s.Wm)(A,{clearable:"",label:"File",outlined:"",modelValue:H.file,"onUpdate:modelValue":a[0]||(a[0]=e=>H.file=e)},{prepend:(0,s.w5)((()=>[(0,s.Wm)(j,{name:"attach_file"})])),_:1},8,["modelValue"]),(0,s.wy)((0,s.Wm)(U,{label:"Send",onClick:I.addMsgFile,"no-caps":"",disable:!H.file,flat:"",color:"primary",class:"q-mt-sm",size:"md"},null,8,["onClick","disable"]),[[X]])])),_:1})])),_:1})])),_:1})])),_:1},8,["onInputCapture","onKeydown","modelValue"])])])),_:1})}var H=t(6303),I=t(1082),M=t(3617),K=t(52),U=t.n(K);const V=new WebSocket("wss://oneconnect.it:4000"),j={data(){return{init:1,message:"",file:null,isTyping:!1,avatar:null,room_id:null,sender:[{type:"sender",message:"hey, how are you?"},{type:"receiver",message:"doing fine, how r you?"}]}},components:{breadcrmps:H.Z},computed:{...(0,M.rn)("chatStore",["chat"]),...(0,M.rn)("example",["user"])},methods:{...(0,M.nv)("example",["getUser"]),...(0,M.nv)("chatStore",["getChat","getMessage"]),format(e){return I.ZP.formatDate(e,"HH:mm")},typing(){V.send(JSON.stringify({typing:{room_id:Number(this.chat.id)}}))},download(e){window.open(e.url)},async addMsgFile(){let e=new FormData;e.append("files",this.file);let a=await U().post("https://onconnect-backend-api.herokuapp.com/api/v1/chats/addFiles/",e,{headers:{Authorization:localStorage.getItem("accessToken")}});a.data.success&&V.send(JSON.stringify({createMessage:{room_id:Number(this.chat.id),text:this.file.name,files:[a.data.data[0].id]}}))},setScrollPos(){},updateScroll(){var e=document.getElementById("room-container");e.scrollTop=e.scrollHeight},send(){if(""===this.message)return;let e=this;V.send(JSON.stringify({createMessage:{room_id:Number(this.chat.id),text:this.message}})),e.message="",setTimeout((()=>{e.updateScroll()}),100)},receive(){setTimeout((()=>{self.updateScroll()}),100)}},async mounted(){await this.getUser()},async mounted(){let e=this;V.addEventListener("open",(async function(e){V.send(JSON.stringify({accessToken:localStorage.getItem("accessToken").substring(7,localStorage.getItem("accessToken").length)}))})),V.addEventListener("message",(async function(a){1===e.init?e.init=2:JSON.parse(a.data).messagePerRoom?JSON.parse(a.data).messagePerRoom.messfinal.room_id===Number(e.chat.id)&&(await e.getMessage(JSON.parse(a.data).messagePerRoom.messfinal),e.updateScroll()):JSON.parse(a.data).userTyping&&(e.room_id=JSON.parse(a.data).userTyping.room_id,e.isTyping=JSON.parse(a.data).userTyping,e.avatar=JSON.parse(a.data).userTyping.avatar,setTimeout((()=>{e.isTyping=!1,e.avatar=null}),2e3)),JSON.parse(a.data).onlineUsers||e.updateScroll()}))},setup(){return{crumps:[{id:1,name:"OneConnect",icon:"home",path:"/"},{id:2,name:"Chat",icon:"chat",path:"/chat"}]}}};var Y=t(4379),R=t(9570),A=t(3747),B=t(5096),E=t(2165),L=t(7704),G=t(629),X=t(4554),$=t(4765),ee=t(4689),ae=t(3944),te=t(5607),se=t(4974),ne=t(677),le=t(7518),ie=t.n(le);j.render=P;const re=j;ie()(j,"components",{QPage:Y.Z,QToolbar:R.Z,QToolbarTitle:A.Z,QAvatar:B.Z,QBtn:E.Z,QScrollArea:L.Z,QChatMessage:G.Z,QIcon:X.Z,QSpinnerDots:$.Z,QInput:ee.Z,QPopupProxy:ae.Z,QBanner:te.Z,QFile:se.Z}),ie()(j,"directives",{ClosePopup:ne.Z})}}]);